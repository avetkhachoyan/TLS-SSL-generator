<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSL Certificate Generator</title>
</head>
<body>
    <h1>Welcome to SSL Certificate Generator</h1>
    <div>
        <label for="keyLength">Key Length:</label>
        <select id="keyLength">
            <option value="2048">2048 bits</option>
            <option value="4096">4096 bits</option>
        </select>
    </div>
    <div>
        <label for="commonName">Common Name (CN):</label>
        <input type="text" id="commonName" placeholder="e.g., localhost">
    </div>
    <div>
        <label for="countryName">Country Name (C):</label>
        <input type="text" id="countryName" placeholder="e.g., US">
    </div>
    <div>
        <label for="stateName">State Name (ST):</label>
        <input type="text" id="stateName" placeholder="e.g., New York">
    </div>
    <div>
        <label for="localityName">Locality Name (L):</label>
        <input type="text" id="localityName" placeholder="e.g., New York">
    </div>
    <div>
        <label for="organizationName">Organization Name (O):</label>
        <input type="text" id="organizationName" placeholder="e.g., Example Org">
    </div>
    <div>
        <label for="organizationalUnit">Organizational Unit (OU):</label>
        <input type="text" id="organizationalUnit" placeholder="e.g., Web Development">
    </div>
    <button onclick="generateCertificate()">Generate Certificate</button>
    <a id="downloadLink" style="display: none;"></a>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/forge/0.10.0/forge.min.js"></script>
    <script>
        function generateCertificate() {
            var keyLength = document.getElementById('keyLength').value;
            var commonName = document.getElementById('commonName').value;
            var countryName = document.getElementById('countryName').value;
            var stateName = document.getElementById('stateName').value;
            var localityName = document.getElementById('localityName').value;
            var organizationName = document.getElementById('organizationName').value;
            var organizationalUnit = document.getElementById('organizationalUnit').value;

            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/generate-certificate", true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);
                        var certPem = response.cert;
                        var privateKeyPem = response.privateKey;
                        var fingerprint = response.fingerprint;
                        downloadFile('certificate.pem', certPem);
                        downloadFile('private-key.pem', privateKeyPem);
                        var link = document.getElementById('downloadLink');
                        link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(fingerprint);
                        link.download = 'fingerprint.txt';
                        link.click();
                    } else {
                        console.error('Failed to generate certificate:', xhr.statusText);
                    }
                }
            };
            xhr.send(JSON.stringify({
                keyLength: keyLength,
                commonName: commonName,
                countryName: countryName,
                stateName: stateName,
                localityName: localityName,
                organizationName: organizationName,
                organizationalUnit: organizationalUnit
            }));
        }

        function downloadFile(filename, content) {
            var element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
            element.setAttribute('download', filename);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }
    </script>
</body>
</html>
