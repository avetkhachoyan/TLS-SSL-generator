<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSL Certificate Generator API</title>
</head>
<body>
    <script>
        function generateCertificate() {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "/generate-certificate", true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);
                        console.log('Certificate:', response.cert);
                        console.log('Private Key:', response.privateKey);
                    } else {
                        console.error('Failed to generate certificate:', xhr.statusText);
                    }
                }
            };
            xhr.send();
        }
    </script>

    <button onclick="generateCertificate()">Generate Certificate</button>

    <script>
        // HTTP server setup
        var http = require('http');
        var forge = require('node-forge');

        var server = http.createServer(function (req, res) {
            if (req.url === '/generate-certificate' && req.method === 'GET') {
                var keys = forge.pki.rsa.generateKeyPair({ bits: 2048 });
                var cert = forge.pki.createCertificate();
                cert.publicKey = keys.publicKey;
                cert.serialNumber = '01';
                cert.validity.notBefore = new Date();
                cert.validity.notAfter = new Date();
                cert.validity.notAfter.setFullYear(cert.validity.notBefore.getFullYear() + 1);
                var attrs = [
                    { name: 'commonName', value: 'localhost' },
                    { name: 'countryName', value: 'US' },
                    { shortName: 'ST', value: 'New York' },
                    { name: 'localityName', value: 'New York' },
                    { name: 'organizationName', value: 'Example Org' },
                    { shortName: 'OU', value: 'Web Development' }
                ];
                cert.setSubject(attrs);
                cert.setIssuer(attrs);
                cert.sign(keys.privateKey);

                var certPem = forge.pki.certificateToPem(cert);
                var privateKeyPem = forge.pki.privateKeyToPem(keys.privateKey);

                res.writeHead(200, { 'Content-Type': 'application/json' });
                res.end(JSON.stringify({ cert: certPem, privateKey: privateKeyPem }));
            } else {
                res.writeHead(404, { 'Content-Type': 'text/plain' });
                res.end('Not Found');
            }
        });

        server.listen(8000, 'localhost', function () {
            console.log('Server running at http://localhost:8000/');
        });
    </script>
</body>
</html>
